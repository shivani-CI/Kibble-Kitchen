{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<!-- Page title -->
<div class="container mt-5" style="background: linear-gradient(to bottom right, #8ee7e0, #9cd2e6); width: 100%; height: auto; border-radius: 10px;">
    {% if is_update %}
        <h2 class="page-title">Edit Recipe</h2>
    {% else %}
        <h2 class="page-title">Create New Recipe</h2>
    {% endif %}
    <hr class="break">
    <div class="row justify-content-center ">
        {% if user.is_authenticated %}
            {% load cloudinary %}
            <div class="col-11 col-md-8 col-lg-6 mt-3 add-recipe-outer">

                <!--  Add Recipe Form -->
                {% if is_update %}
                    <form method="POST" enctype="multipart/form-data" action="{% url 'edit_recipe' recipe.id %}">
                {% else %}
                    <form method="POST" enctype="multipart/form-data" action="{% url 'add_recipe' %}">
                {% endif %}

                {% csrf_token %}
                {{ recipe_form|crispy }}
                <h2>Ingredients</h2>

                <table id="ingredient_formset_tbl">
                    {{ recipe_ingredient_formset.management_form }}
                    {% for recipe_ing_form in recipe_ingredient_formset %}
                        <tr>
                            {% if forloop.first %}
                            <td>{{ recipe_ing_form.ingredient.label_tag }}</td>
                            <td>{{ recipe_ing_form.quantity.label_tag }}</td>
                            <td>{{ recipe_ing_form.unit.label_tag }}</td>
                            {% endif %}
                        </tr>
                        <tr class="ingredient-form">
                            <td>{{ recipe_ing_form.ingredient }}</td>
                            <td>{{ recipe_ing_form.quantity }}</td>
                            <td>{{ recipe_ing_form.unit }}</td>
                            <td><button type="button" class="remove-ingredient-btn">Remove</button></td>
                        </tr>
                    {% endfor %}
                </table>

                <button type="button" id="add_ingredient" class="btn btn-secondary">Add Ingredient</button>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
            </div>
        {% endif %}
    </div>
</div>
{% endblock content %}

{% block extras %}
<script src="{% static 'js/ingredient.js' %}"></script>

{% if messages %}
    {% for message in messages %}
        <script>console.log('{{ message|escapejs }}');</script>
    {% endfor %}
{% endif %}

{% endblock %}